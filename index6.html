<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI è‚Œè†šæª¢æ¸¬ç³»çµ±</title>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils"></script>
    <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
    <style>
        :root { --gold: #d4af37; --white-glass: rgba(255, 255, 255, 0.98); }
        body { 
            margin: 0; padding: 0; display: flex; justify-content: center; align-items: center; 
            min-height: 100vh; font-family: sans-serif; background-color: #000;
            background-image: url('background.jpg'); background-size: cover; background-position: center;
        }
        .card { 
            background: var(--white-glass); border-radius: 30px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.3); width: 90%; max-width: 400px; 
            height: 80vh; /* å›ºå®šé«˜åº¦ï¼Œé˜²æ­¢æŒ‰éˆ•è·‘æ‰ */
            position: relative; overflow: hidden; display: flex; flex-direction: column;
        }
        .content-area { padding: 20px; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .hidden { display: none !important; }
        
        /* ç›¸æ©Ÿå®¹å™¨ï¼šå›ºå®šæ¯”ä¾‹ */
        .video-container { 
            width: 100%; height: 60%; background: #000; border-radius: 20px; 
            overflow: hidden; border: 2px solid var(--gold); position: relative;
        }
        video, canvas { width: 100%; height: 100%; object-fit: cover; }

        /* å›ºå®šåœ¨å¡ç‰‡åº•éƒ¨çš„æŒ‰éˆ• */
        .btn-container { padding: 20px; width: 100%; box-sizing: border-box; }
        .btn-gold { 
            background: var(--gold); color: white; border: none; padding: 15px; 
            border-radius: 30px; cursor: pointer; width: 100%; font-size: 1.1rem; 
            font-weight: bold; transition: 0.3s;
        }

        .question { width: 100%; margin-bottom: 15px; text-align: left; }
        label { font-weight: bold; color: var(--gold); display: block; margin-bottom: 5px; }
        select { width: 100%; padding: 12px; border-radius: 12px; border: 1px solid var(--gold); font-size: 16px; }

        .sparkle { position: fixed; width: 6px; height: 6px; background: var(--gold); border-radius: 50%; pointer-events: none; z-index: 99999; animation: fly 1s forwards; }
        @keyframes fly { 0% { opacity: 1; } 100% { transform: translate(var(--mx), var(--my)) scale(0); opacity: 0; } }
    </style>
</head>
<body>

<div class="card" id="main-card">
    <div id="step-camera" class="content-area">
        <h3 style="color: var(--gold); margin-bottom: 10px;">è«‹å°‡è‡‰éƒ¨å°æº–</h3>
        <div class="video-container">
            <video id="video" playsinline></video>
            <canvas id="canvas"></canvas>
        </div>
        <div class="btn-container">
            <button class="btn-gold" id="btn-capture">ğŸ“· æ‹ç…§åˆ†æ</button>
        </div>
    </div>

    <div id="step-survey" class="content-area hidden">
        <h2 style="color: var(--gold);">AI åˆ†æä¸­</h2>
        <div class="question">
            <label>æ‚¨çš„è†šè³ªé¡å‹</label>
            <select id="user-skin"><option>ä¹¾æ€§</option><option>æ²¹æ€§</option><option>æ··åˆ</option></select>
        </div>
        <div class="question">
            <label>å¹´é½¡å€é–“</label>
            <select id="user-age"><option>20-30</option><option>31-40</option><option>41+</option></select>
        </div>
        <div class="btn-container">
            <button class="btn-gold" id="btn-submit">é€å‡ºæ•¸æ“š</button>
        </div>
    </div>

    <div id="step-report" class="content-area hidden">
        <h2 style="color:var(--gold);">æª¢æ¸¬å ±å‘Š</h2>
        <div id="report-content" style="text-align:left; line-height: 1.6;"></div>
        <div class="btn-container">
            <button class="btn-gold" onclick="location.reload()">é‡æ–°æª¢æ¸¬</button>
        </div>
    </div>
</div>

<div id="sparkle-container"></div>

<script>
    const videoElement = document.getElementById('video');
    let userProfile = { displayName: "è¨ªå®¢" };

    // å•Ÿå‹•ç›¸æ©Ÿï¼šé€™æ®µæ”¾åœ¨æœ€å‰é¢ï¼Œç¢ºä¿ç¶²é ä¸€é–‹å°±è¦æ±‚æ¬Šé™
    async function startCamera() {
        try {
            const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: "user" } });
            videoElement.srcObject = stream;
            videoElement.play();
        } catch (e) {
            console.log("ç›¸æ©Ÿå•Ÿå‹•å¤±æ•—", e);
        }
    }

    // åˆå§‹åŒ– LIFF ä¸¦åŒæ­¥å•Ÿå‹•ç›¸æ©Ÿ
    liff.init({ liffId: "2008812290-AidCIwjS" }).then(() => {
        if (liff.isLoggedIn()) {
            liff.getProfile().then(p => { userProfile = p; });
        }
        startCamera(); // ç¶²é åˆå§‹åŒ–å®Œç•¢å¾Œç«‹åˆ»è¦æ¬Šé™
    });

    // æ‹ç…§æŒ‰éˆ•
    document.getElementById('btn-capture').onclick = function() {
        document.getElementById('step-camera').classList.add('hidden');
        document.getElementById('step-survey').classList.remove('hidden');
    };

    // é€å‡ºæŒ‰éˆ•
    document.getElementById('btn-submit').onclick = function() {
        document.getElementById('step-survey').classList.add('hidden');
        document.getElementById('step-report').classList.remove('hidden');
        const score = Math.floor(Math.random() * 8 + 92);
        document.getElementById('report-content').innerHTML = `
            <b>ğŸ‘‘ æ‚¨å¥½ï¼Œ${userProfile.displayName}</b><br>
            âœ¨ æ°´ç‰å…‰å¾—åˆ†ï¼š${score} åˆ†<br>
            ğŸ§¬ è†šè³ªï¼š${document.getElementById('user-skin').value}<br>
            ğŸ’¡ å»ºè­°ï¼šæ•¸æ“šé¡¯ç¤ºæ‚¨çš„è†šæ³æ¥µä½³ï¼Œè«‹ç¶­æŒç›®å‰çš„ä¿é¤Šç¿’æ…£ã€‚
        `;
    };

    // é‡‘ç²‰ç‰¹æ•ˆ
    document.addEventListener('mousemove', e => spawn(e));
    document.addEventListener('touchmove', e => spawn(e.touches[0]), {passive: true});
    function spawn(e) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = e.clientX + 'px'; s.style.top = e.clientY + 'px';
        s.style.setProperty('--mx', (Math.random()-0.5)*100+'px');
        s.style.setProperty('--my', (Math.random()-0.5)*100+'px');
        document.getElementById('sparkle-container').appendChild(s);
        setTimeout(() => s.remove(), 1000);
    }
</script>
</body>
</html>
